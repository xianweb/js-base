<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript基础 | AJAX、跨域、服务器交互</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/js-base/assets/css/32.styles.40d7528b.css" as="style"><link rel="preload" href="/js-base/assets/js/app.c7e6368d.js" as="script"><link rel="preload" href="/js-base/assets/js/14.de1f5bec.js" as="script"><link rel="prefetch" href="/js-base/assets/js/16.1048e8d5.js"><link rel="prefetch" href="/js-base/assets/js/0.8e9a79d3.js"><link rel="prefetch" href="/js-base/assets/js/1.201620aa.js"><link rel="prefetch" href="/js-base/assets/js/2.76f79118.js"><link rel="prefetch" href="/js-base/assets/js/3.1eceacf3.js"><link rel="prefetch" href="/js-base/assets/js/4.4eab2088.js"><link rel="prefetch" href="/js-base/assets/js/5.414b6ce4.js"><link rel="prefetch" href="/js-base/assets/js/6.96ff2e17.js"><link rel="prefetch" href="/js-base/assets/js/7.5568dd64.js"><link rel="prefetch" href="/js-base/assets/js/8.81d11b54.js"><link rel="prefetch" href="/js-base/assets/js/9.b44e76a0.js"><link rel="prefetch" href="/js-base/assets/js/10.f9ae8728.js"><link rel="prefetch" href="/js-base/assets/js/11.08a380a8.js"><link rel="prefetch" href="/js-base/assets/js/12.93e8efb8.js"><link rel="prefetch" href="/js-base/assets/js/13.d73b01a0.js"><link rel="prefetch" href="/js-base/assets/js/15.ebf70b3c.js"><link rel="prefetch" href="/js-base/assets/js/17.fdf8c912.js"><link rel="prefetch" href="/js-base/assets/js/18.a7544003.js"><link rel="prefetch" href="/js-base/assets/js/19.522aaa0a.js"><link rel="prefetch" href="/js-base/assets/js/20.34656f7d.js"><link rel="prefetch" href="/js-base/assets/js/21.7fc86ce5.js"><link rel="prefetch" href="/js-base/assets/js/22.69f67aae.js"><link rel="prefetch" href="/js-base/assets/js/23.d7e0a2b3.js"><link rel="prefetch" href="/js-base/assets/js/24.e6478d9e.js"><link rel="prefetch" href="/js-base/assets/js/25.6478aed6.js"><link rel="prefetch" href="/js-base/assets/js/26.88f21d7d.js"><link rel="prefetch" href="/js-base/assets/js/27.19b61a5f.js"><link rel="prefetch" href="/js-base/assets/js/28.7c78dbf8.js"><link rel="prefetch" href="/js-base/assets/js/29.75f3055f.js"><link rel="prefetch" href="/js-base/assets/js/30.334b810a.js"><link rel="prefetch" href="/js-base/assets/js/31.98b63597.js">
    <link rel="stylesheet" href="/js-base/assets/css/32.styles.40d7528b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/js-base/" class="home-link router-link-active"><!----><span class="site-name">
      JavaScript基础
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>导论</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>语法</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>标准库</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>DOM操作</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>高级</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/js-base/senior/page1.html" class="sidebar-link">this指针、call和apply的区别</a></li><li><a href="/js-base/senior/page2.html" class="active sidebar-link">AJAX、跨域、服务器交互</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#什么是ajax？" class="sidebar-link">什么是AJAX？</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#老版本的xmlhttprequest对象" class="sidebar-link">老版本的XMLHttpRequest对象</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#新版本的功能" class="sidebar-link">新版本的功能</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#http请求的时限" class="sidebar-link">HTTP请求的时限</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#formdata对象" class="sidebar-link">FormData对象</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#上传文件" class="sidebar-link">上传文件</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#跨域资源共享（cors）" class="sidebar-link">跨域资源共享（CORS）</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#jsonp-跨域" class="sidebar-link">JSONP 跨域</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#postmessage实现跨域通信" class="sidebar-link">postMessage实现跨域通信</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#接收二进制数据" class="sidebar-link">接收二进制数据</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#进度信息" class="sidebar-link">进度信息</a></li><li class="sidebar-sub-header"><a href="/js-base/senior/page2.html#服务器交互" class="sidebar-link">服务器交互</a></li></ul></li><li><a href="/js-base/senior/page3.html" class="sidebar-link">ES6常用特性</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="ajax、跨域、服务器交互"><a href="#ajax、跨域、服务器交互" aria-hidden="true" class="header-anchor">#</a> AJAX、跨域、服务器交互</h1><h2 id="什么是ajax？"><a href="#什么是ajax？" aria-hidden="true" class="header-anchor">#</a> 什么是AJAX？</h2><p>AJAX，实际上指的是<code>XMLHttpRequest</code>对象。</p><p><code>XMLHttpRequest</code>是一个浏览器接口，使得Javascript可以进行HTTP(S)通信。</p><p>最早，微软在IE 5引进了这个接口。因为它太有用，其他浏览器也模仿部署了，ajax操作因此得以诞生。</p><p>但是，这个接口一直没有标准化，每家浏览器的实现或多或少有点不同。HTML 5的概念形成后，W3C开始考虑标准化这个接口。2008年2月，就提出了<code>XMLHttpRequest Level 2</code> 草案。</p><h2 id="老版本的xmlhttprequest对象"><a href="#老版本的xmlhttprequest对象" aria-hidden="true" class="header-anchor">#</a> 老版本的XMLHttpRequest对象</h2><p>在介绍新版本之前，我们先回顾一下老版本的用法。</p><p>首先，新建一个<code>XMLHttpRequest</code>的实例。</p><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>然后，向远程主机发出一个HTTP请求。</p><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'example.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>接着，就等待远程主机做出回应。这时需要监控<code>XMLHttpRequest</code>对象的状态变化，指定回调函数。</p><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span> xhr<span class="token punctuation">.</span>responseText <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span> xhr<span class="token punctuation">.</span>statusText <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h3 id="上面的代码包含了老版本xmlhttprequest对象的主要属性："><a href="#上面的代码包含了老版本xmlhttprequest对象的主要属性：" aria-hidden="true" class="header-anchor">#</a> 上面的代码包含了老版本XMLHttpRequest对象的主要属性：</h3><ul><li><strong>xhr.readyState：</strong><code>XMLHttpRequest</code>对象的状态，等于<strong>4</strong>表示数据已经接收完毕。</li><li><strong>xhr.status：</strong> 服务器返回的状态码，等于<strong>200</strong>表示一切正常。</li><li><strong>xhr.responseText：</strong> 服务器返回的文本数据</li><li><strong>xhr.responseXML：</strong> 服务器返回的<strong>XML</strong>格式的数据</li><li><strong>xhr.statusText：</strong> 服务器返回的状态文本。</li></ul><h3 id="老版本的缺点"><a href="#老版本的缺点" aria-hidden="true" class="header-anchor">#</a> 老版本的缺点:</h3><p>老版本的<code>XMLHttpRequest</code>对象有以下几个缺点：</p><ul><li>只支持<strong>文本数据</strong>的传送，<strong>无法用来读取和上传二进制文件</strong>。</li><li>传送和接收数据时，<strong>没有进度信息</strong>，只能提示有没有完成。</li><li>受到&quot;<strong>同域限制</strong>&quot;（Same Origin Policy），只能向同一域名的服务器请求数据。</li></ul><h2 id="新版本的功能"><a href="#新版本的功能" aria-hidden="true" class="header-anchor">#</a> 新版本的功能</h2><p>新版本的<code>XMLHttpRequest</code>对象，针对老版本的缺点，做出了大幅改进。</p><ul><li>可以设置<code>HTTP</code>请求的时限。</li><li>可以使用<code>FormData</code>对象管理表单数据。</li><li>可以<strong>上传文件</strong>。</li><li>可以请求不同域名下的数据（跨域请求）。</li><li>可以获取服务器端的<strong>二进制数据</strong>。</li><li>可以获得数据传输的<strong>进度信息</strong>。</li></ul><p>下面，我就一一介绍这些新功能。</p><h2 id="http请求的时限"><a href="#http请求的时限" aria-hidden="true" class="header-anchor">#</a> HTTP请求的时限</h2><p>有时，ajax操作很耗时，而且无法预知要花多少时间。如果网速很慢，用户可能要等很久。</p><p>新版本的XMLHttpRequest对象，增加了timeout属性，可以设置HTTP请求的时限。</p><pre class="language-js"><code>xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
</code></pre><p>上面的语句，将最长等待时间设为3000毫秒。过了这个时限，就自动停止HTTP请求。与之配套的还有一个<code>timeout</code>事件，用来指定回调函数。</p><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'请求超时！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>目前，Opera、Firefox和IE 10支持该属性，IE 8和IE 9的这个属性属于XDomainRequest对象，而Chrome和Safari还不支持。</p><h2 id="formdata对象"><a href="#formdata对象" aria-hidden="true" class="header-anchor">#</a> FormData对象</h2><p><code>ajax</code>操作往往用来传递表单数据。为了方便表单处理，HTML 5新增了一个<code>FormData</code>对象，可以<strong>模拟表单</strong>a。</p><p>首先，新建一个<code>FormData</code>对象。</p><pre class="language-js"><code><span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>然后，为它添加表单项。</p><pre class="language-js"><code>formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'张三'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>最后，直接传送这个<code>FormData</code>对象。这与提交网页表单的效果，完全一样。</p><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>FormData对象也可以用来获取网页表单的值。</p><pre class="language-js"><code><span class="token keyword">var</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myform'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'secret'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加一个表单项</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> form<span class="token punctuation">.</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="上传文件"><a href="#上传文件" aria-hidden="true" class="header-anchor">#</a> 上传文件</h2><p>新版<code>XMLHttpRequest</code>对象，不仅可以发送文本信息，还可以上传文件。</p><p>假定<code>files</code>是一个&quot;选择文件&quot;的表单元素（<code>input[type=&quot;file&quot;]</code>），我们将它装入<code>FormData</code>对象。</p><pre class="language-js"><code><span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//多个文件</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'files[]'</span><span class="token punctuation">,</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>然后，发送这个<code>FormData</code>对象。</p><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="跨域资源共享（cors）"><a href="#跨域资源共享（cors）" aria-hidden="true" class="header-anchor">#</a> 跨域资源共享（CORS）</h2><p>新版本的<code>XMLHttpRequest</code>对象，可以向不同域名的服务器发出HTTP请求。这叫做&quot;<strong>跨域资源共享</strong>&quot;（Cross-origin resource sharing，简称CORS）。</p><p>使用&quot;跨域资源共享&quot;的前提，是浏览器必须支持这个功能，而且服务器端必须同意这种&quot;跨域&quot;。<strong>如果能够满足上面的条件，则代码的写法与不跨域的请求完全一样</strong>。</p><p>目前，除了IE 8和IE 9，主流浏览器都支持CORS，IE 10也将支持这个功能。</p><h3 id="服务器端的设置"><a href="#服务器端的设置" aria-hidden="true" class="header-anchor">#</a> 服务器端的设置</h3><p>asp.net 设置跨域</p><pre class="language-js"><code>context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">ClearHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">AppendHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
string requestHeaders <span class="token operator">=</span> context<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Headers<span class="token punctuation">[</span><span class="token string">&quot;Access-Control-Request-Headers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">AppendHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span> 
string<span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>requestHeaders<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;*&quot;</span> <span class="token punctuation">:</span> requestHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span> 
context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">AppendHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST, OPTIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>php 设置跨域</p><pre class="language-php"><code><span class="token comment">// 允许 ityangs.net 发起的跨域请求</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Access-Control-Allow-Origin: baidu.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">//如果需要设置允许所有域名发起的跨域请求，可以使用通配符 *</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Access-Control-Allow-Origin: *&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>java 设置跨域</p><pre class="language-java"><code><span class="token comment">// 最简单的处理方式</span>
response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这个可以用过滤器统一处理</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Request-Method&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// CORS &quot;pre-flight&quot; request</span>
    response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GET, POST, PUT, DELETE, OPTIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;x-requested-with&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Max-Age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//30 min</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="jsonp-跨域"><a href="#jsonp-跨域" aria-hidden="true" class="header-anchor">#</a> JSONP 跨域</h2><ol><li>客户端（a域名）的html文件</li></ol><pre class="language-html"><code><span class="token doctype">&lt;!doctype html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
        <span class="token keyword">function</span> <span class="token function">jsonpCallback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>   
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>result<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//循环输出result的元素  </span>
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.baidu.com/update/index.php?callback=jsonpCallback<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>  
    <span class="token comment">&lt;!-- 传递固定参数的方式 --&gt;</span>
    <span class="token comment">&lt;!-- &lt;script src=&quot;http://www.baidu.com/update/index.php?os=Windows&amp;version=2.0&amp;callback=jsonpCallback&quot;&gt;&lt;/script&gt; --&gt;</span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><ol start="2"><li>服务端（b域名）的php代码：</li></ol><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    
    <span class="token comment">//服务端返回JSON数据  </span>
    <span class="token comment">//$arr=array('a'=&gt;1,'b'=&gt;2,'c'=&gt;3); </span>

    <span class="token variable">$arr</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">version</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;3.3.2.764&quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$arr</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">url</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;#&quot;</span><span class="token punctuation">;</span> 
    <span class="token variable">$result</span><span class="token operator">=</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">//动态执行回调函数  </span>
    <span class="token variable">$callback</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'callback'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
    <span class="token keyword">echo</span> <span class="token variable">$callback</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;(<span class="token interpolation"><span class="token variable">$result</span></span>)&quot;</span><span class="token punctuation">;</span>  
<span class="token delimiter important">?&gt;</span></span>
</code></pre><h2 id="postmessage实现跨域通信"><a href="#postmessage实现跨域通信" aria-hidden="true" class="header-anchor">#</a> postMessage实现跨域通信</h2><ol><li><p>html5最常用的API之一，实现两个不同域窗口对象之间的数据通信。</p></li><li><p>在发送数据窗口执行：<code>otherWindow.postMessage(msg,origin)</code>。</p></li></ol><ul><li><code>otherWindow</code>:表示接受数据的窗口的window对象，包括iframe的contentWindwohe和通过window.open打开的新窗口。</li><li><code>msg</code>表示要发送的数据，包扩字符串和对象(ie9以下不支持，可以利用字符串和json互换)。</li><li><code>origin</code>表示接收的域名。</li></ul><p>在接受的窗口监听<code>window</code>的<code>message</code>事件，回掉函数参数接受一个事件对象event，包括的属性有：</p><ul><li><code>data</code>：接受的数据</li><li><code>origin</code>：发送端的域</li><li><code>source</code>：发送端的DOMWindow对象</li></ul><h3 id="利用window-postmessage在框架之间发送数据"><a href="#利用window-postmessage在框架之间发送数据" aria-hidden="true" class="header-anchor">#</a> 利用<code>window.postMessage</code>在框架之间发送数据</h3><ol><li>在父框架页面<code>index.html</code>发送<code>obj</code>对象给远程服务器的<code>jx-tongan.com/test/b.html</code>，该页面是通过<code>iframe</code>加载的，如下：</li></ol><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>window.postMessage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
	
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	&lt;iframe id=&quot;proxy&quot; src=&quot;http://jx-tongan.com/test/b.html&quot; onload = &quot;postMsg()&quot; style=&quot;display: none&quot; &gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
		<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
			msg<span class="token punctuation">:</span> <span class="token string">'我是来自于首页的数据!'</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">function</span> <span class="token function">postMsg</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">var</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> win <span class="token operator">=</span> iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">;</span>
			win<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'http://jx-tongan.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><ol start="2"><li>在远程页面<code>b.html</code>中监听<code>message</code>事件，先通过<code>origin</code>属性判断下数据来源的域是否可信任，加强安全措施。具体代码如下：</li></ol><pre class="language-html"><code>
<span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
		window<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>origin <span class="token operator">!==</span> <span class="token string">'http://jx-tongan.com'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>origin<span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>this is my server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><h2 id="接收二进制数据"><a href="#接收二进制数据" aria-hidden="true" class="header-anchor">#</a> 接收二进制数据</h2><h3 id="方法a：改写mimetype"><a href="#方法a：改写mimetype" aria-hidden="true" class="header-anchor">#</a> 方法A：改写MIMEType</h3><p>老版本的<code>XMLHttpRequest</code>对象，只能从服务器取回文本数据（否则它的名字就不用<code>XML</code>起首了），新版则可以取回二进制数据。</p><p>这里又分成两种做法。较老的做法是改写数据的<code>MIMEType</code>，将服务器返回的二进制数据伪装成文本数据，并且告诉浏览器这是用户自定义的字符集。</p><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">overrideMimeType</span><span class="token punctuation">(</span><span class="token string">&quot;text/plain; charset=x-user-defined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>然后，用<code>responseText</code>属性接收服务器返回的二进制数据。</p><pre class="language-js"><code><span class="token keyword">var</span> binStr <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
</code></pre><p>由于这时，浏览器把它当做文本数据，所以还必须再一个个字节地还原成二进制数据。</p><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> binStr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> c <span class="token operator">=</span> binStr<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> byte <span class="token operator">=</span> c <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="方法b：responsetype属性"><a href="#方法b：responsetype属性" aria-hidden="true" class="header-anchor">#</a> 方法B：responseType属性</h3><p>从服务器取回二进制数据，较新的方法是使用新增的<code>responseType</code>属性。如果服务器返回文本数据，这个属性的值是&quot;TEXT&quot;，这是默认值。较新的浏览器还支持其他值，也就是说，可以接收其他格式的数据。</p><p>你可以把<code>responseType</code>设为<code>blob</code>，表示服务器传回的是二进制对象。</p><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/path/to/image.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'blob'</span><span class="token punctuation">;</span>
</code></pre><p>接收数据的时候，用浏览器自带的Blob对象即可。</p><pre class="language-js"><code><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token string">'image/png'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="danger custom-block"><p class="custom-block-title">注意</p><p>注意是读取<code>xhr.response</code>，而不是<code>xhr.responseText</code>。</p></div><p>你还可以将<code>responseType</code>设为<code>arraybuffer</code>，把二进制数据装在一个数组里。</p><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/path/to/image.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">&quot;arraybuffer&quot;</span><span class="token punctuation">;</span>
</code></pre><p>接收数据的时候，需要遍历这个数组。</p><pre class="language-js"><code><span class="token keyword">var</span> arrayBuffer <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>arrayBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> byteArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>arrayBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> byteArray<span class="token punctuation">.</span>byteLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="进度信息"><a href="#进度信息" aria-hidden="true" class="header-anchor">#</a> 进度信息</h2><p>新版本的<code>XMLHttpRequest</code>对象，传送数据的时候，有一个<code>progress</code>事件，用来返回进度信息。</p><p>它分成上传和下载两种情况。下载的<code>progress</code>事件属于<code>XMLHttpRequest</code>对象，上传的<code>progress</code>事件属于<code>XMLHttpRequest.upload</code>对象。</p><p>我们先定义<code>progress</code>事件的回调函数。</p><pre class="language-js"><code>xhr<span class="token punctuation">.</span>onprogress <span class="token operator">=</span> updateProgress<span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span>onprogress <span class="token operator">=</span> updateProgress<span class="token punctuation">;</span>
</code></pre><p>然后，在回调函数里面，使用这个事件的一些属性。</p><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateProgress</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> percentComplete <span class="token operator">=</span> event<span class="token punctuation">.</span>loaded <span class="token operator">/</span> event<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><p>上面的代码中，<code>event.total</code>是需要传输的总字节，<code>event.loaded</code>是已经传输的字节。如果<code>event.lengthComputable</code>不为真，则<code>event.total</code>等于0。</p><p>与<code>progress</code>事件相关的，还有其他五个事件，可以分别指定回调函数：</p><ul><li><strong>load事件：</strong> 传输成功完成。</li><li><strong>abort事件：</strong> 传输被用户取消。</li><li><strong>error事件：</strong> 传输中出现错误。</li><li><strong>loadstart事件：</strong> 传输开始。</li><li><strong>loadEnd事件：</strong> 传输结束，但是不知道成功还是失败。</li></ul><h2 id="服务器交互"><a href="#服务器交互" aria-hidden="true" class="header-anchor">#</a> 服务器交互</h2><p>发送请求js</p><pre class="language-js"><code><span class="token comment">//创建request对象</span>
<span class="token keyword">var</span> request<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">)</span><span class="token punctuation">{</span>
    request<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    request<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span>Miscrosoft<span class="token punctuation">.</span><span class="token constant">XMLHTTP</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//创建参数parma</span>
<span class="token keyword">var</span> parma<span class="token punctuation">;</span>
<span class="token comment">//GET请求</span>
request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>url<span class="token operator">+</span><span class="token string">&quot;?&quot;</span><span class="token operator">+</span>parma<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//POST请求</span>
request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
requset<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-tyep&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>prama<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//结果与回复</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>readyStage<span class="token operator">=</span><span class="token number">4</span><span class="token operator">&amp;&amp;</span>request<span class="token punctuation">.</span>status<span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>后端接收请求，以PHP为例</p><pre class="language-php"><code><span class="token comment">//JSon格式头：</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Content-type:application/json&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//php连接数据库</span>
<span class="token variable">$conn</span><span class="token operator">=</span><span class="token function">mysql_connect</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;url&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;username&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//php选择数据库</span>
<span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;dbname&quot;</span><span class="token punctuation">,</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置编码</span>
<span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;set names utf8&quot;</span><span class="token punctuation">,</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//从表中取出数据</span>
<span class="token variable">$rule</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;select * from tb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建结果变量</span>
<span class="token variable">$result</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//输出数组</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token operator">=</span><span class="token function">myaql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$rule</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span><span class="token variable">$row</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span>
<span class="token comment">//输出json</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token operator">=</span><span class="token function">myaql_fetch_assoc</span><span class="token punctuation">(</span><span class="token variable">$rule</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$row</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span>
</code></pre></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/js-base/senior/page1.html" class="prev">
          this指针、call和apply的区别
        </a></span><span class="next"><a href="/js-base/senior/page3.html">
          ES6常用特性
        </a> →
      </span></p></div></div></div></div>
    <script src="/js-base/assets/js/14.de1f5bec.js" defer></script><script src="/js-base/assets/js/app.c7e6368d.js" defer></script>
  </body>
</html>
